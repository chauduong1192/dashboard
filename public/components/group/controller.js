"use strict";angular.module(window.APP.modules.group).controller("groups",["$scope","$state","$stateParams","$filter","alertify","groupAPI",function(a,b,c,d,e,f){function g(){h(a.query,function(b){a.groups=b,i(a.query,function(b){a.count.groups=b})})}function h(a,b){f.query(a,function(a){b&&b(a)})}function i(a,b){f.count(a,function(a){b&&b(a.total)})}function j(a,b){a.$delete(function(a){b&&b(a),e.success(d("translate")("X_HAS_BEEN_DELETED",a.name))},function(a){a.data.validationErrors&&a.data.validationErrors.message&&e.alert(d("translate")(a.data.validationErrors.message))})}a.query={query:void 0,sort:"name",page:1,limit:25},a.count={groups:0},g(),a.search=function(b){b&&(a.query.sort=b),g()},a.canCreate=function(){return f.canCreate()},a["delete"]=function(b){b&&b.canDelete()&&confirm(d("translate")("CONFIRM_DELETE_X",b.name))&&j(b,function(b){a.groups.forEach(function(c,d){c._id===b._id&&a.groups.splice(d,1)})})}}]).controller("groupDetails",["$scope","$state","$stateParams","$filter","alertify","groupAPI","userAPI","settingAPI",function(a,b,c,d,e,f,g,h){function i(a,c){f.get(a,function(a){c&&c(a)},function(a){b.go("groups")})}function j(b,c){b.$save(function(a){c&&c(a),e.success(d("translate")("X_HAS_BEEN_CREATED",a.name))},function(b){b.data.validationErrors&&(a.validationErrors=b.data.validationErrors)})}function k(b,c){b.$update(function(a){c&&c(a),e.success(d("translate")("X_HAS_BEEN_UPDATED",a.name))},function(b){b.data.validationErrors&&(a.validationErrors=b.data.validationErrors)})}function l(a,b){a.$delete(function(a){b&&b(a),e.success(d("translate")("X_HAS_BEEN_DELETED",a.name))},function(a){a.data.validationErrors&&a.data.validationErrors.message&&e.alert(d("translate")(a.data.validationErrors.message))})}function m(a,b){g.query(a,function(a){b&&b(a)})}function n(a,b){h.get(a,function(a){b&&b(a)})}"groupCreate"===b.current.name?(a.state="create",a.group=new f({name:void 0})):(a.state="details",i({_id:c.groupId},function(b){a.group=b,m({limit:0,page:0,sort:"email",filter:{group:a.group._id}},function(b){a.users=b})})),n({_id:"DEFAULT_PERMISSIONS"},function(b){a.permissions=[],Object.keys(b.value).forEach(function(c){a.permissions.push({resource:c,permissions:b.value[c]})})}),a.validationErrors={name:void 0},a.save=function(){a.form.$valid&&("create"===a.state?a.group.canCreate()&&j(a.group,function(c){a.form.$setPristine(),b.go("groupDetails",{groupId:c._id})}):a.group.canEdit()&&k(a.group,function(b){a.form.$setPristine(),a.group=b}))},a["delete"]=function(){a.group.canDelete()&&confirm(d("translate")("CONFIRM_DELETE_X",a.group.name))&&l(a.group,function(c){a.form.$setPristine(),b.go("groups")})}}]);